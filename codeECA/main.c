#include <stdio.h>
#include <stdlib.h>

#include "lib.h"


int main (){

	float samples[600] = {
		40.198505,
		38.948036,
		37.844048,
		36.984100,
		36.387115,
		35.993244,
		35.690872,
		35.357643,
		34.898773,
		34.270359,
		33.483898,
		32.596222,
		31.692232,
		30.866251,
		30.204220,
		29.767061,
		29.576828,
		29.610458,
		29.807020,
		30.090929,
		30.405579,
		30.743776,
		31.158745,
		31.745775,
		32.598415,
		33.757591,
		35.178978,
		36.737869,
		38.273342,
		39.652859,
		40.825809,
		41.837654,
		42.795097,
		43.798187,
		44.873913,
		45.947315,
		46.868046,
		47.481678,
		47.710396,
		47.600651,
		47.310612,
		47.040600,
		46.939720,
		47.035828,
		47.225510,
		47.331001,
		47.196606,
		46.776066,
		46.165825,
		45.565742,
		45.185406,
		45.141964,
		45.400436,
		45.786476,
		46.065815,
		46.051620,
		45.687492,
		45.066620,
		44.379612,
		43.818653,
		43.486263,
		43.352898,
		43.281834,
		43.105610,
		42.713203,
		42.103699,
		41.381145,
		40.696785,
		40.171665,
		39.841805,
		39.654495,
		39.515949,
		39.362282,
		39.212662,
		39.172482,
		39.380795,
		39.926960,
		40.779522,
		41.766903,
		42.625099,
		43.094543,
		43.023182,
		42.428162,
		41.487289,
		40.464191,
		39.602043,
		39.034340,
		38.751331,
		38.632591,
		38.524242,
		38.319378,
		38.001850,
		37.635147,
		37.307739,
		37.068535,
		36.889500,
		36.676361,
		36.321049,
		35.766666,
		35.048840,
		34.290016,
		33.648617,
		33.249146,
		33.129612,
		33.233681,
		33.451530,
		33.687778,
		33.920612,
		34.220318,
		34.715977,
		35.525425,
		36.682735,
		38.100071,
		39.585705,
		40.914455,
		41.922550,
		42.586388,
		43.049252,
		43.579384,
		44.469582,
		45.912308,
		47.897236,
		50.174343,
		52.306335,
		53.803364,
		54.300812,
		53.718224,
		52.334972,
		50.740704,
		49.661598,
		49.713425,
		51.168243,
		53.826244,
		57.050259,
		59.958466,
		61.705978,
		61.747513,
		59.981327,
		56.726994,
		52.563267,
		48.110756,
		43.859089,
		40.102276,
		36.980083,
		34.565006,
		32.916988,
		32.061790,
		31.911947,
		32.201668,
		32.511513,
		32.407722,
		31.641598,
		30.296774,
		28.778969,
		27.620708,
		27.184267,
		27.424385,
		27.862814,
		27.821690,
		26.812029,
		24.863731,
		22.587538,
		20.891708,
		20.473850,
		21.360458,
		22.774448,
		23.450138,
		22.260880,
		18.819183,
		13.685473,
		8.020414,
		2.848741,
		-1.615007,
		-6.079507,
		-11.487622,
		-17.752457,
		-22.584345,
		-21.219433,
		-7.567723,
		23.354952,
		72.573410,
		135.167267,
		200.298203,
		253.666687,
		281.778076,
		276.516907,
		238.231354,
		176.005630,
		104.879852,
		41.009632,
		-3.401748,
		-23.493345,
		-22.280910,
		-8.355803,
		8.097939,
		19.235868,
		21.898539,
		17.665627,
		10.964543,
		6.362363,
		6.361919,
		10.600301,
		16.573433,
		21.283958,
		22.865316,
		21.387938,
		18.567726,
		16.677145,
		17.313890,
		20.665020,
		25.571970,
		30.259888,
		33.279079,
		34.159649,
		33.491573,
		32.470921,
		32.216221,
		33.231613,
		35.263855,
		37.563118,
		39.349529,
		40.212601,
		40.248482,
		39.908039,
		39.685375,
		39.840679,
		40.302269,
		40.773228,
		40.952286,
		40.728676,
		40.244225,
		39.803394,
		39.697964,
		40.051746,
		40.766804,
		41.588367,
		42.240826,
		42.556549,
		42.534744,
		42.312824,
		42.080051,
		41.986210,
		42.089607,
		42.358749,
		42.711342,
		43.059540,
		43.336552,
		43.498646,
		43.514095,
		43.356262,
		43.010323,
		42.489166,
		41.844654,
		41.161388,
		40.530903,
		40.017296,
		39.631897,
		39.330910,
		39.037804,
		38.678989,
		38.214893,
		37.651947,
		37.032345,
		36.410427,
		35.830826,
		35.320194,
		34.894386,
		34.572212,
		34.382145,
		34.352520,
		34.487103,
		34.739334,
		35.003735,
		35.137524,
		35.011147,
		34.570030,
		33.880028,
		33.131413,
		32.592094,
		32.522659,
		33.084641,
		34.279346,
		35.944016,
		37.808598,
		39.590736,
		41.089890,
		42.242374,
		43.117100,
		43.858521,
		44.606464,
		45.430775,
		46.308678,
		47.149971,
		47.851055,
		48.346325,
		48.629959,
		48.739971,
		48.718853,
		48.578320,
		48.292484,
		47.825699,
		47.178867,
		46.424015,
		45.700550,
		45.166626,
		44.925339,
		44.963276,
		45.137413,
		45.224724,
		45.017277,
		44.420254,
		43.505417,
		42.491577,
		41.657993,
		41.229408,
		41.285698,
		41.737358,
		42.376019,
		42.972717,
		43.374493,
		43.553097,
		43.585869,
		43.584694,
		43.615154,
		43.651550,
		43.592262,
		43.326126,
		42.811710,
		42.123241,
		41.433846,
		40.940056,
		40.763702,
		40.881496,
		41.120991,
		41.229610,
		40.987103,
		40.309269,
		39.293507,
		38.183563,
		37.268799,
		36.763771,
		36.722923,
		37.028130,
		37.452530,
		37.769119,
		37.852741,
		37.728935,
		37.548820,
		37.503986,
		37.722664,
		38.196182,
		38.770103,
		39.204647,
		39.277744,
		38.885090,
		38.092960,
		37.119984,
		36.254536,
		35.741718,
		35.686569,
		36.013275,
		36.496960,
		36.854908,
		36.860142,
		36.431717,
		35.666466,
		34.801327,
		34.123573,
		33.866879,
		34.135021,
		34.881626,
		35.949429,
		37.147430,
		38.330200,
		39.445980,
		40.537529,
		41.702663,
		43.038555,
		44.597404,
		46.369797,
		48.293694,
		50.272655,
		52.185284,
		53.880375,
		55.170494,
		55.847832,
		55.740112,
		54.800404,
		53.194668,
		51.333218,
		49.802456,
		49.193165,
		49.875751,
		51.814137,
		54.512096,
		57.139942,
		58.811054,
		58.902729,
		57.283623,
		54.342743,
		50.802654,
		47.402084,
		44.598679,
		42.434063,
		40.620857,
		38.794754,
		36.785576,
		34.750095,
		33.086292,
		32.174965,
		32.100628,
		32.526321,
		32.816772,
		32.360931,
		30.918224,
		28.780092,
		26.628912,
		25.148024,
		24.594736,
		24.595907,
		24.321106,
		22.975979,
		20.352713,
		17.099590,
		14.490223,
		13.740533,
		15.200920,
		17.879942,
		19.639444,
		18.073294,
		11.702498,
		0.896098,
		-11.995966,
		-23.443802,
		-30.131176,
		-30.252335,
		-24.020325,
		-13.075660,
		0.923233,
		17.747377,
		39.182697,
		68.222946,
		107.052780,
		154.716995,
		205.706406,
		250.427383,
		277.732025,
		278.710938,
		250.256882,
		196.850296,
		129.670532,
		63.228458,
		10.766986,
		-19.795067,
		-27.834389,
		-19.258419,
		-3.492766,
		10.410595,
		16.929962,
		15.340372,
		8.847951,
		2.276813,
		-0.479386,
		1.903013,
		8.022515,
		14.903190,
		19.701982,
		21.077623,
		19.619677,
		17.273298,
		16.187391,
		17.630831,
		21.494909,
		26.538744,
		31.147202,
		34.152493,
		35.305820,
		35.221138,
		34.903488,
		35.165516,
		36.245659,
		37.790920,
		39.155712,
		39.812794,
		39.644047,
		38.974495,
		38.364941,
		38.301456,
		38.954155,
		40.119106,
		41.349384,
		42.186386,
		42.366940,
		41.913334,
		41.085266,
		40.241390,
		39.690071,
		39.595367,
		39.962032,
		40.680145,
		41.588997,
		42.525963,
		43.349163,
		43.944210,
		44.232140,
		44.186478,
		43.851353,
		43.343140,
		42.822456,
		42.439686,
		42.275158,
		42.302933,
		42.399052,
		42.394165,
		42.148052,
		41.611298,
		40.844749,
		39.987724,
		39.191158,
		38.549126,
		38.062622,
		37.652908,
		37.216354,
		36.691345,
		36.101295,
		35.549515,
		35.166237,
		35.033195,
		35.124649,
		35.297832,
		35.343369,
		35.076920,
		34.431561,
		33.506927,
		32.548565,
		31.861792,
		31.694939,
		32.142277,
		33.110020,
		34.361565,
		35.622723,
		36.700180,
		37.559723,
		38.328167,
		39.217464,
		40.405148,
		41.926308,
		43.628448,
		45.213463,
		46.352039,
		46.822674,
		46.614712,
		45.948734,
		45.202103,
		44.767727,
		44.902912,
		45.629597,
		46.726185,
		47.813499,
		48.499493,
		48.525082,
		47.855614,
		46.686508,
		45.366756,
		44.274525,
		43.693302,
		43.730831,
		44.301735,
		45.169300,
		46.023434,
		46.566120,
		46.581856,
		45.981838,
		44.820049,
		43.282959,
		41.653957,
		40.253723,
		39.362633,
		39.141338,
		39.574696,
		40.465218,
		41.489292,
		42.305462,
		42.678055,
		42.565815,
		42.133236,
		41.672440,
		41.464020,
		41.637020,
		42.094337,
		42.544094,
		42.629791,
		42.103554,
		40.962029,
		39.476852,
		38.098099,
		37.268265, 
		37.228863, 
		37.908623, 
		38.947327
	};

	float maiorNum = maiorVet(samples, 600);

	printf("maiorNum = %f\n", maiorNum);

	float media = mediaVet(samples, 600);

	printf("\n\nmedia = %f\n", media);

	float mediaRec = mediaVetRecursiva(samples, 600, 600);

	printf("\n\n\n ####### mediaRec = %f\n\n", mediaRec);

	float valorInteresse = (maiorNum+media)/2;

	printf("valorInteresse = %f\n", valorInteresse);

	int inicio_pico_R[15], fim_pico_R[15], picos_R[15], conta_picos_R=0;


	conta_picos_R = procuraZonaR(samples, 600, inicio_pico_R, fim_pico_R, valorInteresse);

	printf("####################\n");
	printf("conta_picos_R = %i\n", conta_picos_R);
	printf("####################\n");

	//	calcular todos os picos_R
	int i, tam;	
	float maiorPicoR;


	for(i=0; i<conta_picos_R; i++){
		tam = fim_pico_R[i] - inicio_pico_R[i];
		picos_R[i] = maiorValorVetIndex(samples + inicio_pico_R[i], tam);
		printf("o indice do maior valor eh %i + %i = %i\n", inicio_pico_R[i], picos_R[i], inicio_pico_R[i]+picos_R[i]);
		picos_R[i] += inicio_pico_R[i]; //picos_R[i] = inicio_pico_R[i] + picos_R[i];

	}

	//dados fake
	int ac = picos_R[1];
	for (i = 2; i < 15; ++i){
		ac += 360;
		picos_R[i] = ac;
	}


	float freq = 360.0, BPM;
	int dist_pontos;
	for(i=0; i<14; ++i){
		dist_pontos = picos_R[ i + 1 ] - picos_R[ i ];
		BPM = calcBPM(dist_pontos, freq);
		printf("freq cardiaca %i eh = %f BPM\n", i+1, BPM);
	}	


	// 1 batida ---- 0.73 seg (tempo1batida)
	// BPM 		---- 60 seg 
	// calculando todos os BPM


    return 0;
}
